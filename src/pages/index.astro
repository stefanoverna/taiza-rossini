---
import Layout from '@/layouts/Layout.astro';
import HorizontalScroller from '@/components/HorizontalScroller.astro';
import Tile from '@/components/Tile.astro';
import UnwrapStructuredText from '@/components/UnwrapStructuredText.astro';
import Work from '@/components/Work.astro';
import { request } from '@/lib/dato';
import type { HomeQuery } from '@/lib/types';
import { StructuredText } from '@datocms/astro';

const query = `
  query Home {
    homepage {
      _seoMetaTags {
        tag
        attributes
        content
      }
      title
      tagline {
        value
      }
      description {
        value
      }
    }

    works: allWorks(orderBy: position_ASC, first: 100) {
      id
      coverImage {
        responsiveImage(imgixParams: { auto: format, h: 1400 }) {
          src
          srcSet
          base64
          width
          height
        }
      }
    }

    meta: _allWorksMeta {
      count
    }
  }
`;

const {
  homepage,
  works,
  meta: { count },
} = await request<HomeQuery>(query);
---

<Layout seoTags={homepage?._seoMetaTags || []}>
  <main style="counter-reset: work-counter;">
    <HorizontalScroller>
      {
        homepage && (
          <Tile>
            <div class="mx-7 py-12 xl:m-0 xl:w-[60vw] xl:max-w-[900px] xl:flex xl:items-center xl:justify-items-center xl:p-32">
              <div>
                <div class="uppercase tracking-widest text-sm mb-12 xl:mb-12">
                  {homepage.title}
                </div>
                <h1 class="text-black font-serif mb-12 text-5xl xl:text-7xl tracking-tight">
                  <StructuredText data={homepage.tagline.value} />
                </h1>
                <div class="leading-loose prose max-w-none">
                  <StructuredText data={homepage.description.value} />
                </div>
              </div>
            </div>
          </Tile>
        )
      }
      {
        works.map((work) => (
          <Tile>
            <Work work={work} total={count} />
          </Tile>
        ))
      }
    </HorizontalScroller>
  </main>
</Layout>
